<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <meta name="author" content="Bharath(yamakira_)">
  
  <title>OS detection - The Art of Packet Crafting with Scapy!</title>
  

  <link rel="shortcut icon" href="../img/favicon.ico">

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="../css/highlight.css">

  
  <script>
    // Current page data
    var mkdocs_page_name = "OS detection";
    var mkdocs_page_input_path = "os_detection.md";
    var mkdocs_page_url = "/os_detection/index.html";
  </script>
  
  <script src="../js/jquery-2.1.1.min.js"></script>
  <script src="../js/modernizr-2.8.3.min.js"></script>
  <script type="text/javascript" src="../js/highlight.pack.js"></script>
  <script src="../js/theme.js"></script> 

  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href="../license/index.html" class="icon icon-home"> The Art of Packet Crafting with Scapy!</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        <ul class="current">
          
            <li>
    <ul class="subnav">
    <li><span>Workshop intro</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../license/index.html">License</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../bigger_picture/index.html">Bigger picture</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../speakers/index.html">Speakers</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../workshop_settings/index.html">Workshop settings</a>
        
    </li>

        
    </ul>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>Virtual Lab</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../lab_setup/index.html">Virtual Lab</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../lab_topology/index.html">Topology</a>
        
    </li>

        
    </ul>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>Networking</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../layers/index.html">Layers</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../socket_interface/index.html">Socket Interface</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../packet_headers/index.html">Packet Headers</a>
        
    </li>

        
    </ul>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>Python Course</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../python/index.html">Python</a>
        
    </li>

        
    </ul>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>Scapy Course</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../scapy_intro/index.html">Scapy Intro</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../scapy_modes/index.html">Scapy Modes</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../scapy_exploring/index.html">Exploring scapy</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../creating_packets/index.html">Creating packets</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../inspecting_packets/index.html">Inspecting packets</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../sending_recieving/index.html">Sending & Recieving</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../sniffing/index.html">Sniffing</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../pcap_analysis/index.html">PCAP Analysis</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../host_discovery/index.html">Host discovery</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../service_discovery/index.html">Service discovery</a>
        
    </li>

        
            
    <li class="toctree-l1 current">
        <a class="current" href="index.html">OS detection</a>
        
            <ul>
            
                <li class="toctree-l3"><a href="#remote-os-detection">Remote OS Detection</a></li>
                
                    <li><a class="toctree-l4" href="#ambiguity-in-protocol-implementations">Ambiguity in protocol implementations</a></li>
                
                    <li><a class="toctree-l4" href="#passive-os-fingerprinting">Passive OS fingerprinting</a></li>
                
            
            </ul>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../promisc/index.html">Promisc detection</a>
        
    </li>

        
    </ul>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>ScapyHunt</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../scapyhunt/index.html">Scapy Hunt</a>
        
    </li>

        
    </ul>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>Epilogue</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../feedback/index.html">Feedback</a>
        
    </li>

        
    </ul>
<li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../license/index.html">The Art of Packet Crafting with Scapy!</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../license/index.html">Docs</a> &raquo;</li>
    
      
        
          <li>Scapy Course &raquo;</li>
        
      
    
    <li>OS detection</li>
    <li class="wy-breadcrumbs-aside">
      
        
          <a href="https://github.com/yamakira/The-Art-of-Packet-Crafting-with-Scapy" class="icon icon-github"> Edit on GitHub</a>
        
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="remote-os-detection">Remote OS Detection</h1>
<h2 id="ambiguity-in-protocol-implementations">Ambiguity in protocol implementations</h2>
<p>RFC 793 says:
"ACK (1 bit) â€“ indicates that the Acknowledgment field is significant. All packets after the initial SYN packet sent by the client should have this flag set".</p>
<p>But, IP stacks are written for different OSs by different people who read the RFCs and then write their interpretation of what the RFC outlines into code. This leads to a difference in how IP stacks are implemeted across OSes.</p>
<h3 id="linux-implementation">Linux implementation</h3>
<p>Linux kernel 2.4+ accepts and acknowledges a segment in an established session where no TCP flags are set and where the segment has payload No other well known current operating system accepts this same segment..</p>
<h3 id="the-technique">The Technique:</h3>
<p align = 'center'>
<img alt='lists1' style="display:block; margin:0 auto" alt="calling sorted with key=len" src='../img/linux_detect.png'>
</p>

<div class="admonition warning">
<p class="admonition-title">Why RST??</p>
<p>The kernel is not aware of what Scapy is doing behind his back. If Scapy sends a SYN, the target replies with a SYN-ACK and your kernel sees it, it will reply with a RST.</p>
<p>To prevent this, use local firewall rules (e.g. NetFilter for Linux). Scapy does not mind about local firewalls.</p>
</div>
<p><strong>-- IPTABLES COMMAND --- </strong></p>
<div class="admonition note">
<p class="admonition-title">Corner cases: Curious case of 127.0.0.1</p>
<p>The loopback interface is a very special. Packets going through it are not really assembled and dissassembled.</p>
<p>The kernel routes the packet to its destination while it is still stored an internal structure. The kernel is not aware of what Scapy is doing behind his back, so what you see on the lo interface is also a fake. Except this one did not come from a local structure. Thus the kernel will never receive it.</p>
<p>To speak to local applications, you need to build your packets one layer upper, using a PF_INET/SOCK_RAW socket instead of a PF_PACKET/SOCK_RAW (or its equivalent on other systems that Linux).</p>
</div>
<h2 id="passive-os-fingerprinting">Passive OS fingerprinting</h2>
<h3 id="ttl-window-size-analysis">TTL &amp; Window size analysis</h3>
<p><img alt="" src="../../img/ttl_window.png" /> </p>
<p>--- scapy p0f --
-- nmap os db --
-- active scans --</p>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../promisc/index.html" class="btn btn-neutral float-right" title="Promisc detection">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../service_discovery/index.html" class="btn btn-neutral" title="Service discovery"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
	  
        </div>
      </div>

    </section>

  </div>

<div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
          <a href="https://github.com/yamakira/The-Art-of-Packet-Crafting-with-Scapy" class="icon icon-github" style="float: left; color: #fcfcfc"> GitHub</a>
      
      
        <span><a href="../service_discovery/index.html" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../promisc/index.html" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>

</body>
</html>
